# Test Configuration for AgeGraphStorageTest
# Override only the properties that are required for graph storage tests

# Allow unmapped configuration properties (legacy lightrag.* properties)
smallrye.config.mapping.validate-unknown=false

# Entity Resolution Configuration for Tests  
# Test-specific configuration tuned for test fixtures
# Tests include edge cases (abbreviations, typos, partial names) that require:
# 1. Lower threshold (0.40 vs production default 0.75) to catch harder cases
# 2. Slightly adjusted weights to balance different matching types
# Production systems should tune these based on domain (see quickstart.md)
lightrag.entity.resolution.enabled=true
lightrag.entity.resolution.similarity.threshold=0.40
# Balanced weights for test scenarios mixing abbreviations and partial names
lightrag.entity.resolution.weight.jaccard=0.35
lightrag.entity.resolution.weight.containment=0.25
lightrag.entity.resolution.weight.edit=0.30
lightrag.entity.resolution.weight.abbreviation=0.10

# LightRAG Configuration - using defaults where possible
lightrag.vector.table.name=lightrag_vectors_test
lightrag.vector.dimension=4000
lightrag.graph.name=lightrag_graph_test
lightrag.chunk.size=1200
lightrag.chunk.overlap=100
lightrag.query.top.k=10
lightrag.query.chunk.top.k=5
lightrag.storage.working.dir=./lightrag-data-test
lightrag.query.mode=hybrid

# LightRAG Concurrency Controls
lightrag.llm.max.concurrent.calls=10
lightrag.kg.extraction.batch.size=20
lightrag.embedding.batch.size=32

# LightRAG Entity Description Merging
lightrag.entity.description.max.length=1000
lightrag.entity.description.separator= | 

# LightRAG Query System Prompts - using test placeholders
lightrag.query.system.prompt.local=Test local prompt
lightrag.query.system.prompt.global=Test global prompt
lightrag.query.system.prompt.hybrid=Test hybrid prompt
lightrag.query.system.prompt.naive=Test naive prompt
lightrag.query.system.prompt.mix=Test mix prompt
lightrag.query.system.prompt.bypass=Test bypass prompt
lightrag.entity.extraction.system.prompt=Test entity extraction prompt
lightrag.entity.types=organization,person,location,event
lightrag.extraction.language=English
lightrag.entity.extraction.user.prompt=Test entity extraction user prompt

# REST Client URLs - not needed for graph storage tests but required by config
quarkus.rest-client."llm-embedding".url=http://localhost:8080
quarkus.rest-client."llm-chat".url=http://localhost:8080
llm-embedding.api-key=test-key
llm-chat.api-key=test-key
embedding.model=test-model
chat.model=test-model
chat.temperature=0.7
chat.max.tokens=1000
chat.top.p=1.0
chat.system.prompt=Test system prompt
chat.system.prompt.no.context=Test system prompt no context
document.processor.batch.size=10

# Disable scheduled jobs for tests
document.processor.schedule.marking=off
document.processor.schedule.processing=off

# Database Configuration
quarkus.hibernate-orm.database.default.generation=none
quarkus.hibernate-orm.database.default-schema=rag

# =============================================================================
# Retry Configuration for Tests (SmallRye Fault Tolerance)
# =============================================================================
# Faster retries for tests - keep same structure but reduce delays

# Max attempts: initial + retries (3 retries = 4 total attempts)
retry/maxRetries=3

# Shorter delays for tests: 50ms initial, exponential backoff
retry/delay=50
retry/delayUnit=MILLIS
retry/maxDuration=5000
retry/durationUnit=MILLIS

# Minimal jitter for predictable test behavior
retry/jitter=10
retry/jitterDelayUnit=MILLIS

# Enable fault tolerance logging for test observability
quarkus.log.category."io.smallrye.faulttolerance".level=DEBUG
quarkus.log.category."br.edu.ifba.lightrag.utils.RetryEventLogger".level=DEBUG
