quarkus.swagger-ui.always-include=true
quarkus.smallrye-openapi.path=/openapi
mp.openapi.extensions.smallrye.info.title=RAG SaaS API
mp.openapi.extensions.smallrye.info.version=1.0.0
mp.openapi.extensions.smallrye.info.description=API for RAG SaaS application

quarkus.rest-client."llm-embedding".url=${LLM_EMBEDDING_URL}
quarkus.rest-client."llm-embedding".read-timeout=2147483647
quarkus.rest-client."llm-embedding".connect-timeout=2147483647
quarkus.rest-client."llm-embedding".logging.scope=request-response
quarkus.rest-client."llm-embedding".logging.body-limit=8192
llm-embedding.api-key=${LLM_EMBEDDING_API_KEY:}
embedding.model=${EMBEDDING_MODEL}

document.processor.batch.size=${DOCUMENT_PROCESSOR_BATCH_SIZE}

# Increase worker thread blocking timeout for long-running embedding API calls
quarkus.vertx.max-worker-execute-time=5m

quarkus.rest-client."llm-chat".url=${LLM_CHAT_URL}
quarkus.rest-client."llm-chat".read-timeout=2147483647
quarkus.rest-client."llm-chat".connect-timeout=2147483647
quarkus.rest-client."llm-chat".logging.scope=request-response
quarkus.rest-client."llm-chat".logging.body-limit=8192
llm-chat.api-key=${LLM_CHAT_API_KEY:}

chat.model=${CHAT_MODEL}
chat.temperature=${CHAT_TEMPERATURE}
chat.max.tokens=${CHAT_MAX_TOKENS}
chat.top.p=${CHAT_TOP_P}
chat.system.prompt=${CHAT_SYSTEM_PROMPT}
chat.system.prompt.no.context=${CHAT_SYSTEM_PROMPT_NO_CONTEXT}

# File upload size limits
quarkus.http.limits.max-body-size=50M
quarkus.http.body.handle-file-uploads=true
quarkus.http.body.uploads-directory=${java.io.tmpdir}/quarkus-uploads

# CORS configuration
quarkus.http.cors.enabled=true
quarkus.http.cors.origins=*
quarkus.http.cors.methods=GET,POST,PUT,DELETE,OPTIONS,PATCH
quarkus.http.cors.headers=accept,authorization,content-type,x-requested-with
quarkus.http.cors.exposed-headers=*
quarkus.http.cors.access-control-max-age=24H
quarkus.http.cors.access-control-allow-credentials=true

# LightRAG Configuration
lightrag.vector.table.name=${LIGHTRAG_VECTOR_TABLE_NAME:lightrag_vectors}
lightrag.vector.dimension=${LIGHTRAG_VECTOR_DIMENSION:4000}
lightrag.chunk.size=${LIGHTRAG_CHUNK_SIZE:1200}
lightrag.chunk.overlap=${LIGHTRAG_CHUNK_OVERLAP:100}
lightrag.query.top.k=${LIGHTRAG_QUERY_TOP_K:10}
lightrag.query.chunk.top.k=${LIGHTRAG_QUERY_CHUNK_TOP_K:5}
lightrag.storage.working.dir=${LIGHTRAG_STORAGE_WORKING_DIR:./lightrag-data}
lightrag.query.mode=${LIGHTRAG_QUERY_MODE}

# LightRAG Concurrency Controls
# Maximum concurrent LLM API calls (prevents thread exhaustion)
lightrag.llm.max.concurrent.calls=${LIGHTRAG_LLM_MAX_CONCURRENT_CALLS:10}
# Number of chunks to process in parallel within each batch for entity extraction
lightrag.kg.extraction.batch.size=${LIGHTRAG_KG_EXTRACTION_BATCH_SIZE:20}
# Number of chunks to batch together for embedding API calls
lightrag.embedding.batch.size=${LIGHTRAG_EMBEDDING_BATCH_SIZE:32}

# LightRAG Entity Description Merging
# Maximum length for accumulated entity descriptions (prevents excessive storage)
lightrag.entity.description.max.length=${LIGHTRAG_ENTITY_DESCRIPTION_MAX_LENGTH:1000}
# Separator used when concatenating multiple descriptions
lightrag.entity.description.separator=${LIGHTRAG_ENTITY_DESCRIPTION_SEPARATOR: | }

# LightRAG Query System Prompts
lightrag.query.system.prompt.local=${LIGHTRAG_LOCAL_CHAT_SYSTEM_PROMPT}
lightrag.query.system.prompt.global=${LIGHTRAG_GLOBAL_CHAT_SYSTEM_PROMPT}
lightrag.query.system.prompt.hybrid=${LIGHTRAG_HYBRID_CHAT_SYSTEM_PROMPT}
lightrag.query.system.prompt.naive=${LIGHTRAG_NAIVE_CHAT_SYSTEM_PROMPT}
lightrag.query.system.prompt.mix=${LIGHTRAG_MIX_CHAT_SYSTEM_PROMPT}
lightrag.query.system.prompt.bypass=${LIGHTRAG_BYPASS_CHAT_SYSTEM_PROMPT}
lightrag.entity.extraction.system.prompt=${LIGHTRAG_ENTITY_EXTRACTION_SYSTEM_PROMPT}
lightrag.entity.types=${LIGHTRAG_ENTITY_TYPES}
lightrag.extraction.language=${LIGHTRAG_EXTRACTION_LANGUAGE}
lightrag.entity.extraction.user.prompt=${LIGHTRAG_ENTITY_EXTRACTION_USER_PROMPT}

# Entity Resolution Configuration
# Feature toggle for semantic entity deduplication
lightrag.entity.resolution.enabled=${LIGHTRAG_ENTITY_RESOLUTION_ENABLED:true}

# Similarity threshold for considering entities as duplicates [0.0, 1.0]
# Higher = more conservative (fewer merges), Lower = more aggressive (more merges)
# Recommended: 0.70-0.75 (literary texts), 0.75-0.80 (news), 0.80-0.85 (academic)
lightrag.entity.resolution.similarity.threshold=${LIGHTRAG_ENTITY_RESOLUTION_THRESHOLD:0.75}

# Maximum number of aliases to store per entity
lightrag.entity.resolution.max.aliases=${LIGHTRAG_ENTITY_RESOLUTION_MAX_ALIASES:5}

# Clustering algorithm: "threshold" (connected components) or "dbscan"
lightrag.entity.resolution.clustering.algorithm=${LIGHTRAG_ENTITY_RESOLUTION_CLUSTERING:threshold}

# Similarity Metric Weights (must sum to 1.0)
# Jaccard: token overlap matching (e.g., "Warren Home" vs "Warren State Home")
lightrag.entity.resolution.weight.jaccard=${LIGHTRAG_ENTITY_RESOLUTION_WEIGHT_JACCARD:0.35}
# Containment: substring matching (e.g., "MIT" vs "Massachusetts Institute of Technology")
lightrag.entity.resolution.weight.containment=${LIGHTRAG_ENTITY_RESOLUTION_WEIGHT_CONTAINMENT:0.25}
# Edit distance: character-level similarity (handles typos)
lightrag.entity.resolution.weight.edit=${LIGHTRAG_ENTITY_RESOLUTION_WEIGHT_EDIT:0.30}
# Abbreviation: acronym matching (e.g., "IBM" vs "International Business Machines")
lightrag.entity.resolution.weight.abbreviation=${LIGHTRAG_ENTITY_RESOLUTION_WEIGHT_ABBREV:0.10}

# Performance Tuning
# Batch size for processing entities (larger = more memory, faster processing)
lightrag.entity.resolution.batch.size=${LIGHTRAG_ENTITY_RESOLUTION_BATCH_SIZE:200}
# Enable parallel processing for similarity computation
lightrag.entity.resolution.parallel.enabled=${LIGHTRAG_ENTITY_RESOLUTION_PARALLEL_ENABLED:true}
# Number of threads for parallel processing
lightrag.entity.resolution.parallel.threads=${LIGHTRAG_ENTITY_RESOLUTION_PARALLEL_THREADS:4}

# Phase 3 - Semantic Similarity (OPTIONAL - disabled by default)
# Uses entity embeddings for description-based semantic matching
lightrag.entity.resolution.semantic.enabled=${LIGHTRAG_ENTITY_RESOLUTION_SEMANTIC_ENABLED:false}
# Weight for semantic similarity in combined score (only used if semantic.enabled=true)
lightrag.entity.resolution.semantic.weight=${LIGHTRAG_ENTITY_RESOLUTION_SEMANTIC_WEIGHT:0.40}

# Logging Configuration
# Log entity merge decisions at INFO level
lightrag.entity.resolution.log.merges=${LIGHTRAG_ENTITY_RESOLUTION_LOG_MERGES:true}
# Log detailed similarity scores at DEBUG level (verbose)
lightrag.entity.resolution.log.similarity.scores=${LIGHTRAG_ENTITY_RESOLUTION_LOG_SCORES:false}

# Database Configuration
# Use 'none' since we manage schema via SQL init scripts in Docker
quarkus.hibernate-orm.database.generation=none
quarkus.hibernate-orm.schema-generation.create-schemas=false
# Set default schema for Hibernate ORM
quarkus.hibernate-orm.database.default-schema=rag

# REST Client Logging
quarkus.log.category."org.jboss.resteasy.reactive.client".level=DEBUG
quarkus.log.category."br.edu.ifba.chat.LlmChatClient".level=DEBUG
quarkus.log.category."br.edu.ifba.chat.LlmChatClientExceptionMapper".level=DEBUG
quarkus.log.category."br.edu.ifba.document.LlmEmbeddingClient".level=DEBUG
quarkus.log.category."br.edu.ifba.lightrag.adapters.QuarkusEmbeddingAdapter".level=DEBUG
quarkus.log.category."br.edu.ifba.lightrag.storage.impl.AgeGraphStorage".level=DEBUG

# =============================================================================
# Retry Configuration (SmallRye Fault Tolerance)
# =============================================================================
# Documentation: https://quarkus.io/guides/smallrye-fault-tolerance

# Global retry defaults for storage operations
# Max attempts: initial + retries (3 retries = 4 total attempts)
retry/maxRetries=3

# Exponential backoff: starts at 200ms, doubles each attempt
# Attempt 1: 0ms, Attempt 2: 200ms, Attempt 3: 400ms, Attempt 4: 800ms
retry/delay=200
retry/delayUnit=MILLIS
retry/maxDuration=30000
retry/durationUnit=MILLIS

# Jitter to prevent thundering herd (Â±20% of delay)
retry/jitter=200
retry/jitterDelayUnit=MILLIS

# Enable fault tolerance logging for observability
quarkus.log.category."io.smallrye.faulttolerance".level=INFO
quarkus.log.category."br.edu.ifba.lightrag.utils.RetryEventLogger".level=INFO
